<div class="book-detail-container">

  <!-- DEBUG - Solo se isDebugMode è true -->
  <div *ngIf="isDebugMode" class="debug-panel">
    <h3 class="debug-title">DEBUG PANEL:</h3>
    <div class="debug-grid">
      <div class="debug-item">
        <span class="debug-label">loading:</span>
        <span [class]="loading ? 'debug-value loading-true' : 'debug-value loading-false'">
          {{loading}}
        </span>
      </div>
      <div class="debug-item">
        <span class="debug-label">error:</span>
        <span [class]="error ? 'debug-value error-true' : 'debug-value error-false'">
          {{error || 'null'}}
        </span>
      </div>
    </div>
  </div>

  <!-- STATI DELL'APPLICAZIONE -->
  <div class="content-wrapper">

    <!-- Caricamento -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <h1>Caricamento in corso...</h1>
      <p>Stiamo recuperando i dati del libro</p>
    </div>

    <!-- Errore -->
    <div *ngIf="!loading && error" class="error-state">
      <div class="error-icon">⚠️</div>
      <h1>Errore nel caricamento</h1>
      <p class="error-message">
        {{error}}
      </p>
      <button (click)="reloadData()" class="retry-button">
        Riprova
      </button>
    </div>

    <!-- Dati libro -->
    <div *ngIf="!loading && !error" class="book-data">
      
      <!-- Header -->
      <div class="book-header">
        <span [class]="book?.available_copies > 0 ? 'availability-badge available' : 'availability-badge unavailable'">
          {{book?.available_copies > 0 ? 'Disponibile' : 'Esaurito'}}
        </span>
        <h1 class="book-title">
          {{book?.title || 'Titolo non disponibile'}}
        </h1>
      </div>

      <!-- Layout a due colonne -->
      <div class="two-column-layout">
        
        <!-- Colonna sinistra -->
        <div class="left-column">
          <!-- Immagine -->
          <div class="image-container">
            <img *ngIf="book?.image" 
                 [src]="book.image" 
                 [alt]="book.title"
                 (error)="handleImageError($event)"
                 class="book-image">
            <div *ngIf="!book?.image" class="image-placeholder">
              Immagine non disponibile
            </div>
          </div>

          <!-- Disponibilità -->
          <div class="availability-container">
            <h3>Disponibilità</h3>
            <div class="availability-stats">
              <div class="stat-item">
                <span class="stat-label">Copie disponibili:</span>
                <span class="stat-value">
                  {{book?.available_copies ?? 0}}
                </span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Copie totali:</span>
                <span class="stat-value">
                  {{book?.total_copies ?? 0}}
                </span>
              </div>
            </div>
            <div class="availability-bar">
              <div [style.width.%]="getAvailabilityPercentage()" class="availability-fill"></div>
            </div>
            <p class="availability-percentage">
              {{getAvailabilityPercentage()}}% disponibile
            </p>
          </div>
        </div>

        <!-- Colonna destra -->
        <div class="right-column">
          <!-- Dettagli libro -->
          <div class="book-details-grid">
            <div class="detail-item">
              <span class="detail-label">Autore:</span>
              <span class="detail-value">
                {{book?.author || 'N/A'}}
              </span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Categoria:</span>
              <span class="detail-value">
                {{book?.category || 'N/A'}}
              </span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Anno di pubblicazione:</span>
              <span class="detail-value">
                {{book?.year || 'N/A'}}
              </span>
            </div>
            <div class="detail-item">
              <span class="detail-label">ISBN:</span>
              <span class="detail-value">
                {{book?.isbn || 'N/A'}}
              </span>
            </div>
          </div>

          <!-- Descrizione -->
          <div *ngIf="book?.description" class="description-section">
            <h3>Descrizione</h3>
            <div class="description-content">
              {{book.description}}
            </div>
          </div>

          <!-- Messaggio se nessuna descrizione -->
          <div *ngIf="!book?.description" class="no-description">
            <p>Nessuna descrizione disponibile per questo libro</p>
          </div>

          <!-- Note -->
          <div class="note-section">
            <div class="note-content">
              <strong>Nota:</strong> Tutti i dati sono sempre visibili e aggiornati in tempo reale
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="footer-section">
        <div class="last-update">
          Ultimo aggiornamento: {{formatDate(currentTimestamp)}}
        </div>
      </div>
    </div>
  </div>
</div>