<div class="page-wrapper">
  <div class="form-card">
    
    <!-- Testata -->
    <header class="form-header">
      <h1>üìö Nuovo Libro</h1>
      <p>Inserisci i dettagli nel catalogo</p>
    </header>

    <div class="form-body">
      <!-- Messaggio Successo -->
      <div class="alert-success" *ngIf="showSuccessMessage">
        ‚úÖ Libro aggiunto con successo!
      </div>

      <form #bookForm="ngForm" (ngSubmit)="onSubmit()">
        
        <!-- Campo Titolo -->
        <div class="input-group">
          <label>Titolo *</label>
          <input type="text" name="title" [(ngModel)]="newBook.title" required placeholder="Es: Il Signore degli Anelli">
        </div>

        <!-- Campo Autore -->
        <div class="input-group">
          <label>Autore *</label>
          <input type="text" name="author" [(ngModel)]="newBook.author" required placeholder="Nome dell'autore">
        </div>

        <!-- Campo ISBN -->
        <div class="input-group">
          <label>ISBN</label>
          <input 
            type="text" 
            name="ISBN" 
            [(ngModel)]="newBook.ISBN" 
            placeholder="Es: 978-88-04-66259-2"
            pattern="^(?:ISBN(?:-1[03])?:? )?(?=[0-9X]{10}$|(?=(?:[0-9]+[- ]){3})[- 0-9X]{13}$|97[89][0-9]{10}$|(?=(?:[0-9]+[- ]){4})[- 0-9]{17}$)(?:97[89][- ]?)?[0-9]{1,5}[- ]?[0-9]+[- ]?[0-9]+[- ]?[0-9X]$"
            title="Inserisci un ISBN valido (es: 978-88-04-66259-2)">
          <small class="text-muted">Formato: ISBN-10 o ISBN-13 (opzionale)</small>
        </div>

        <!-- Categoria e Anno (Due colonne) -->
        <div class="flex-row">
          <div class="input-group">
            <label>Categoria</label>
            <select name="category" [(ngModel)]="newBook.category">
              <option value="">Scegli...</option>
              <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            </select>
          </div>
          <div class="input-group">
            <label>Anno</label>
            <input type="number" name="year" [(ngModel)]="newBook.year" placeholder="2024">
          </div>
        </div>

        <!-- Descrizione -->
        <div class="input-group">
          <label>Descrizione</label>
          <textarea name="description" [(ngModel)]="newBook.description" rows="3"></textarea>
        </div>

        <!-- Copie (Due colonne) -->
        <div class="flex-row">
          <div class="input-group">
            <label>Copie Totali</label>
            <input type="number" name="total_copies" [(ngModel)]="newBook.total_copies">
          </div>
          <div class="input-group">
            <label>Disponibili</label>
            <input type="number" name="available_copies" [(ngModel)]="newBook.available_copies">
          </div>
        </div>

        <!-- Anteprima Immagine -->
        <div class="image-section">
          <label>Link Copertina</label>
          <input type="url" name="image" [(ngModel)]="newBook.image" placeholder="Incolla URL immagine">
          
          <div class="preview-box" *ngIf="newBook.image">
            <img [src]="newBook.image" (error)="imageError = true" *ngIf="!imageError">
            <p *ngIf="imageError">‚ö†Ô∏è Immagine non valida</p>
          </div>
        </div>

        <!-- Azioni (Bottoni) -->
        <div class="form-actions">
          <button type="button" class="btn-alt" (click)="goBack()">Indietro</button>
          <button type="submit" class="btn-main" [disabled]="!bookForm.form.valid">
            Salva Libro
          </button>
        </div>

      </form>
    </div>
  </div>
</div>